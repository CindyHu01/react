webpackJsonp([0x6f86d85e6f37],{916:function(n,s){n.exports={data:{markdownRemark:{html:'<p>更新UI时，React在内部使用几种巧妙的技术来最小化DOM操作的数量。对许多应用来说，使用React不需要做太多的优化工作就可以快速创建用户界面。除此之外，还有一些优化React应用性能的办法。</p>\n<h2 id="使用生产版本"><a href="#%E4%BD%BF%E7%94%A8%E7%94%9F%E4%BA%A7%E7%89%88%E6%9C%AC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用生产版本</h2>\n<p>在React应用中检测性能问题时，请务必使用压缩过的生产版本。</p>\n<p>默认情况下，React包含很多在开发过程中很有帮助的警告。然而，这会导致React更大更慢。因此，在部署应用时，请确认使用了生产版本。</p>\n<p>如果你不确定构建过程是否正确，可以安装<a href="https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi">React开发者工具（chrome）</a>。当你访问一个生产模式的React页面时，这个工具的图标会有一个黑色的背景：</p>\n\n  <a class="gatsby-resp-image-link" href="/static/devtools-prod-d0f767f80866431ccdec18f200ca58f1-1e9b4.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 600px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 21.16666666666667%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAtElEQVQI142ISwqDMABEvf+Fumyh4C5p1ChtoUZj/EUEG/MxUbHppus+GObNBPu+O+fWP9jc5qzTxkghTpcriJOg73uttZJSKy2l7x/zN/OslBTvt/dpmayzq1utXVo+vHIShGGYJBhC+Lg/bxAlcYxxmqYYAID9D2CWZRFCKEJnehFGWLMopY7joJQGpCCM1U3TMMZITmqvrafzs++6qmL+4cNQVbTICee8bdqyLLU24zh+AGg72y61QftkAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;" alt="React DevTools on a website with production version of React" title="" src="/static/devtools-prod-d0f767f80866431ccdec18f200ca58f1-1e9b4.png" srcset="/static/devtools-prod-d0f767f80866431ccdec18f200ca58f1-1cd08.png 210w,\n/static/devtools-prod-d0f767f80866431ccdec18f200ca58f1-9b07a.png 420w,\n/static/devtools-prod-d0f767f80866431ccdec18f200ca58f1-1e9b4.png 600w" sizes="(max-width: 600px) 100vw, 600px">\n    </span>\n  </span>\n  \n  </a>\n    \n<p>当你访问一个开发模式的React页面时，这个工具的图标会有一个红色的背景：</p>\n\n  <a class="gatsby-resp-image-link" href="/static/devtools-dev-e434ce2f7e64f63e597edf03f4465694-1e9b4.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 600px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 33.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAABYlAAAWJQFJUiTwAAABI0lEQVQY04WQ3XKCMBCFef+X6k2tkAIGRa1Ox5kOGiCAkt81gtINM73uudicTTaz324w/qfnn9Bi6u739nr9eX8rDvvAzLLWAlitNXqttFJq9to/WOsLAB7OPMfHNE3DOJqm7rsuSJKURITSLM/zMAw3m3WWZXEcRxFZpWmSovxJSPx9WHXNBcBJIWeQMbgwxmteMnY+nxl63vCm5byu8bKsGCs5523TFkXBWFVzXlXV6XQCgGEYAqSaCT2b0lIpibTaeGYAP5EUAiP4RAsh0HjyYXDOBYvFB11RhM2zr3BB42hN413yucvpcUOPOFG4XOJoOAAhZLfdK6mmWb7zvBvci9ES5A1kb2+duXVa9La/GiwFa6XE9gIB8cPr9cLo1+7cL+jygk7PcoV8AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;" alt="React DevTools on a website with development version of React" title="" src="/static/devtools-dev-e434ce2f7e64f63e597edf03f4465694-1e9b4.png" srcset="/static/devtools-dev-e434ce2f7e64f63e597edf03f4465694-1cd08.png 210w,\n/static/devtools-dev-e434ce2f7e64f63e597edf03f4465694-9b07a.png 420w,\n/static/devtools-dev-e434ce2f7e64f63e597edf03f4465694-1e9b4.png 600w" sizes="(max-width: 600px) 100vw, 600px">\n    </span>\n  </span>\n  \n  </a>\n    \n<p>最好在开发应用时使用开发模式，部署应用时换为生产模式。</p>\n<p>以下是构建生产应用的流程。</p>\n<h3 id="create-react-app方式"><a href="#create-react-app%E6%96%B9%E5%BC%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Create React App方式</h3>\n<p>如果你的项目是以<a href="https://github.com/facebookincubator/create-react-app">Create React App</a>创建的，运行如下代码：</p>\n<div class="gatsby-highlight">\n      <pre class="gatsby-code-text"><code class="gatsby-code-text">npm run build</code></pre>\n      </div>\n<p>这将会在该项目的<code class="gatsby-code-text">build/</code>文件夹内创建一个生产版本的应用。</p>\n<p>注意只有发布项目时才有必要这样做，正常开发时，使用<code class="gatsby-code-text">npm start</code>。</p>\n<h3 id="单文件生产版本"><a href="#%E5%8D%95%E6%96%87%E4%BB%B6%E7%94%9F%E4%BA%A7%E7%89%88%E6%9C%AC" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>单文件生产版本</h3>\n<p>我们提供压缩好的生产版本的React和React DOM文件:</p>\n<div class="gatsby-highlight">\n      <pre class="gatsby-code-html"><code class="gatsby-code-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://unpkg.com/react@15/dist/react.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://unpkg.com/react-dom@15/dist/react-dom.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>\n</code></pre>\n      </div>\n<p>注意只有结尾为<code class="gatsby-code-text">.min.js</code>的React文件才是适合生产使用的。</p>\n<h3 id="brunch"><a href="#brunch" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Brunch</h3>\n<p>为了创建最高效的Brunch生产版本，需要安装<a href="https://github.com/brunch/uglify-js-brunch"><code class="gatsby-code-text">uglify-js-brunch</code></a> 插件:</p>\n<div class="gatsby-highlight">\n      <pre class="gatsby-code-text"><code class="gatsby-code-text"># If you use npm\nnpm install --save-dev uglify-js-brunch\n\n# If you use Yarn\nyarn add --dev uglify-js-brunch</code></pre>\n      </div>\n<p>接下来，为了构建生产版本，在<code class="gatsby-code-text">build</code>命令后添加<code class="gatsby-code-text">-p</code>参数：</p>\n<div class="gatsby-highlight">\n      <pre class="gatsby-code-text"><code class="gatsby-code-text">brunch build -p</code></pre>\n      </div>\n<p>注意只有生产版本需要这样操作。不要在开发环境中安装这个插件或者使用<code class="gatsby-code-text">-p</code>参数，因为它会隐藏掉有用的React警告并使构建过程更慢。</p>\n<h3 id="browserify"><a href="#browserify" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Browserify</h3>\n<p>为了创建最高效的Browserify生产版本，需要安装一些插件：</p>\n<div class="gatsby-highlight">\n      <pre class="gatsby-code-text"><code class="gatsby-code-text"># If you use npm\nnpm install --save-dev bundle-collapser envify uglify-js uglifyify \n\n# If you use Yarn\nyarn add --dev bundle-collapser envify uglify-js uglifyify </code></pre>\n      </div>\n<p>为了构建生产版本，务必添加这些设置指令 <strong>(参数很重要)</strong>:</p>\n<ul>\n<li><a href="https://github.com/hughsk/envify"><code class="gatsby-code-text">envify</code></a>该插件确保正确的编译环境，全局安装（<code class="gatsby-code-text">-g</code>）。</li>\n<li><a href="https://github.com/hughsk/uglifyify"><code class="gatsby-code-text">uglifyify</code></a>该插件移除了开发接口。全局安装（<code class="gatsby-code-text">-g</code>）。</li>\n<li><a href="https://github.com/substack/bundle-collapser"><code class="gatsby-code-text">bundle-collapser</code></a>该插件用数字替代了长长的模块ID。</li>\n<li>最后，以上结果都被输添加至<a href="https://github.com/mishoo/UglifyJS2"><code class="gatsby-code-text">uglify-js</code></a>来得到整合。(<a href="https://github.com/hughsk/uglifyify#motivationusage">了解原因</a>).</li>\n</ul>\n<p>举个例子：</p>\n<div class="gatsby-highlight">\n      <pre class="gatsby-code-text"><code class="gatsby-code-text">browserify ./index.js \\\n  -g [ envify --NODE_ENV production ] \\\n  -g uglifyify \\\n  -p bundle-collapser/plugin \\\n  | uglifyjs --compress --mangle &gt; ./bundle.js</code></pre>\n      </div>\n<blockquote>\n<p><strong>注意：</strong></p>\n<p>包的名称是<code class="gatsby-code-text">uglify-js</code>，但是它提供的文件叫<code class="gatsby-code-text">uglifyjs</code>。<br>\n这不是一个错字。</p>\n</blockquote>\n<p>注意只有生产版本需要这样操作。不要在开发环境中安装这些插件，因为它们会隐藏掉有用的React警告并使构建过程更慢。</p>\n<h3 id="rollup"><a href="#rollup" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Rollup</h3>\n<p>为了创建最高效的Rollup生产版本，需要安装一些插件：</p>\n<div class="gatsby-highlight">\n      <pre class="gatsby-code-text"><code class="gatsby-code-text"># If you use npm\nnpm install --save-dev rollup-plugin-commonjs rollup-plugin-replace rollup-plugin-uglify \n\n# If you use Yarn\nyarn add --dev rollup-plugin-commonjs rollup-plugin-replace rollup-plugin-uglify </code></pre>\n      </div>\n<p>为了构建生产版本，务必添加这些插件 <strong>(参数很重要)</strong>:</p>\n<ul>\n<li><a href="https://github.com/rollup/rollup-plugin-replace"><code class="gatsby-code-text">replace</code></a>该插件确保正确的编译环境。</li>\n<li><a href="https://github.com/rollup/rollup-plugin-commonjs"><code class="gatsby-code-text">commonjs</code></a>该插件在Rollup内提供对CommonJS的支持。</li>\n<li><a href="https://github.com/TrySound/rollup-plugin-uglify"><code class="gatsby-code-text">uglify</code></a>该插件压缩生成最终版本。</li>\n</ul>\n<div class="gatsby-highlight">\n      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx">plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>\n  <span class="token comment">// ...</span>\n  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'rollup-plugin-replace\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n    <span class="token string">\'process.env.NODE_ENV\'</span><span class="token punctuation">:</span> JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token string">\'production\'</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'rollup-plugin-commonjs\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">\'rollup-plugin-uglify\'</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n  <span class="token comment">// ...</span>\n<span class="token punctuation">]</span>\n</code></pre>\n      </div>\n<p>查看完整的<a href="https://gist.github.com/Rich-Harris/cb14f4bc0670c47d00d191565be36bf0">安装例子</a>.</p>\n<p>注意只有生产版本需要这样操作。不要在开发环境中安装<code class="gatsby-code-text">uglify</code>和<code class="gatsby-code-text">replace</code>，因为它们会隐藏掉有用的React警告并使构建过程更慢。</p>\n<h3 id="webpack"><a href="#webpack" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Webpack</h3>\n<blockquote>\n<p><strong>注意：</strong></p>\n<p>如果你正在使用<a href="#create-react-app">Create React App</a>方式，参考上述文档。<br>\n本节只适用于直接配置Webpack的情况。</p>\n</blockquote>\n<p>为了创建最高效的Webpack生产版本，需要在生产版本的配置中添加这些插件：</p>\n<div class="gatsby-highlight">\n      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n  <span class="token string">\'process.env\'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>\n    NODE_ENV<span class="token punctuation">:</span> JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token string">\'production\'</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n<span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>optimize<span class="token punctuation">.</span>UglifyJsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n</code></pre>\n      </div>\n<p>了解更多参见<a href="https://webpack.js.org/guides/production-build/">Webpack文档</a>.</p>\n<p>注意只有生产版本需要这样操作。不要在开发环境中安装<code class="gatsby-code-text">UglifyJsPlugin</code>和<code class="gatsby-code-text">DefinePlugin</code>，因为它们会隐藏掉有用的React警告并使构建过程更慢。</p>\n<h2 id="使用-chrome-performance-归档组件"><a href="#%E4%BD%BF%E7%94%A8-chrome-performance-%E5%BD%92%E6%A1%A3%E7%BB%84%E4%BB%B6" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用 Chrome Performance 归档组件</h2>\n<p>在<strong>开发</strong>模式下， 在支持的浏览器内使用性能工具可以直观的了解组件何时挂载，更新和卸载。例如：</p>\n<center>\n  <a class="gatsby-resp-image-link" href="/static/react-perf-chrome-timeline-64d522b74fb585f1abada9801f85fa9d-dcc89.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 651px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 35.023041474654384%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsSAAALEgHS3X78AAABYUlEQVQY022NeUsCURTF5yMG0aaZSgniMtqCEfQlgoowqCCoRDNIs+gfdVTMJa3JbdRyaROHyXJ0xuc47zVqC0Rw7uHec/lxsPeqmyJ0WT+e8xspwli+wp9ipnZ+QRJHzfP3y3RyPeXAMycm0oEXXeayx/zmXWIDliZhwXgmHzuQxQ+VKefcg0db9+kaQT1D6Gm/vu7V0gEzW7JVLxTF45Gya4wLyoSwvBOaAqFJEBrHel2+Gt1PnGqj9onIkTx3pqLcyrxbVfdrGsFZJowLbKlbcHK32+BmAyTXAGntkFZAboH0LgYhRBCKIAUYX9JmiO0pSLsm7pzJeNSVy2k6toKgAIcSOVFgYY+DQguKvJT34T4tGULP6R3KO0pTm48Rw8v1In23ytWcUg6//mhg6OtACBtuUrfkzdd44VzdqkXZSuijTIB6QuSYbxj+YH/hfiKNwPN0Vuy2ByUQoV/mX/gTU11epAmedTIAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;" alt="React components in Chrome timeline" title="" src="/static/react-perf-chrome-timeline-64d522b74fb585f1abada9801f85fa9d-dcc89.png" srcset="/static/react-perf-chrome-timeline-64d522b74fb585f1abada9801f85fa9d-cf87c.png 210w,\n/static/react-perf-chrome-timeline-64d522b74fb585f1abada9801f85fa9d-ba000.png 420w,\n/static/react-perf-chrome-timeline-64d522b74fb585f1abada9801f85fa9d-dcc89.png 651w" sizes="(max-width: 651px) 100vw, 651px">\n    </span>\n  </span>\n  \n  </a>\n    </center>\n<p>Chrome浏览器内：</p>\n<ol>\n<li>\n<p>在项目地址栏内添加查询字符串 <code class="gatsby-code-text">?react_perf</code>（例如， <code class="gatsby-code-text">http://localhost:3000/?react_perf</code>）。</p>\n</li>\n<li>\n<p>打开Chrome开发工具<strong><a href="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/timeline-tool">Performance</a></strong> 标签页点击<strong>Record</strong>.</p>\n</li>\n<li>\n<p>执行你想要分析的动作。不要记录超过20s，不然Chrome可能会挂起。</p>\n</li>\n<li>\n<p>停止记录。</p>\n</li>\n<li>\n<p>React事件将会被归类在 <strong>User Timing</strong>标签下。</p>\n</li>\n</ol>\n<p>更多的详细操作，请参考 <a href="https://building.calibreapp.com/debugging-react-performance-with-react-16-and-chrome-devtools-c90698a522ad">BenSchwarz 的这篇文章</a>。</p>\n<p>注意<strong>由于这些数字是相对的，因此组件在生产版本中会运行更快</strong>。然而，这也能够帮助你了解何时会有无关的组件被错误的更新，以及你的组件更新的深度和频率。</p>\n<p>目前浏览器中仅有Chrome，Edge和IE支持此特性，但是我们使用此标准<a href="https://developer.mozilla.org/en-US/docs/Web/API/User_Timing_API">用户Timing API</a>，因此我们期待更多的浏览器对其添加支持。</p>\n<h2 id="虚拟化长列表"><a href="#%E8%99%9A%E6%8B%9F%E5%8C%96%E9%95%BF%E5%88%97%E8%A1%A8" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>虚拟化长列表</h2>\n<p>If your application renders long lists of data (hundreds or thousands of rows), we recommended using a technique known as “windowing”. This technique only renders a small subset of your rows at any given time, and can dramatically reduce the time it takes to re-render the components as well as the number of DOM nodes created.</p>\n<p><a href="https://react-window.now.sh/">react-window</a> and <a href="https://bvaughn.github.io/react-virtualized/">react-virtualized</a> are popular windowing libraries. They provide several reusable components for displaying lists, grids, and tabular data. You can also create your own windowing component, like <a href="https://medium.com/@paularmstrong/twitter-lite-and-high-performance-react-progressive-web-apps-at-scale-d28a00e780a3">Twitter did</a>, if you want something more tailored to your application’s specific use case.</p>\n<h2 id="避免协调"><a href="#%E9%81%BF%E5%85%8D%E5%8D%8F%E8%B0%83" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>避免协调</h2>\n<p>React在渲染出的UI内部建立和维护了一个内层的实现方式，它包括了从组件返回的React元素。这种实现方式使得React避免了一些不必要的创建和关联DOM节点，因为这样做可能比直接操作JavaScript对象更慢一些。有时它被称之为“虚拟DOM”，但是它其实和React Native的工作方式是一样的。</p>\n<p>当一个组件的<code class="gatsby-code-text">props</code>或者<code class="gatsby-code-text">state</code>改变时，React通过比较新返回的元素和之前渲染的元素来决定是否有必要更新实际的DOM。当他们不相等时，React会更新DOM。</p>\n<p>You can now visualize these re-renders of the virtual DOM with React DevTools:</p>\n<ul>\n<li><a href="https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi?hl=en">Chrome Browser Extension</a></li>\n<li><a href="https://addons.mozilla.org/en-GB/firefox/addon/react-devtools/">Firefox Browser Extension</a></li>\n<li><a href="https://www.npmjs.com/package/react-devtools">Standalone Node Package</a></li>\n</ul>\n<p>In the developer console select the <strong>Highlight Updates</strong> option in the <strong>React</strong> tab:</p>\n<p><a href="https://reactjs.org/static/devtools-highlight-updates-97eda4825de476af4515435a0c36ca78-a62e3.png"><img src="https://reactjs.org/static/devtools-highlight-updates-97eda4825de476af4515435a0c36ca78-acf85.png" alt="How to enable highlight updates"></a></p>\n<p>Interact with your page and you should see colored borders momentarily appear around any components that have re-rendered. This lets you spot re-renders that were not necessary. You can learn more about this React DevTools feature from this <a href="https://blog.logrocket.com/make-react-fast-again-part-3-highlighting-component-updates-6119e45e6833">blog post</a> from <a href="https://blog.logrocket.com/@edelstein">Ben Edelstein</a>.</p>\n<p>Consider this example:</p>\n<p><img src="https://reactjs.org/highlight-updates-example-7a42123e91b1b460b1a65605d6ff0d2b.gif" alt="React DevTools Highlight Updates example"></p>\n<p>Note that when we’re entering a second todo, the first todo also flashes on the screen on every keystroke. This means it is being re-rendered by React together with the input. This is sometimes called a “wasted” render. We know it is unnecessary because the first todo content has not changed, but React doesn’t know this.</p>\n<p>Even though React only updates the changed DOM nodes, re-rendering still takes some time. In many cases it’s not a problem, but if the slowdown is noticeable, you can speed all of this up by overriding the lifecycle function <code class="gatsby-code-text">shouldComponentUpdate</code>, which is triggered before the re-rendering process starts. The default implementation of this function returns <code class="gatsby-code-text">true</code>, leaving React to perform the update:</p>\n<p>在一些情况下，你的组件可以通过重写这个生命周期函数<code class="gatsby-code-text">shouldComponentUpdate</code>来提升速度， 它是在重新渲染过程开始前触发的。 这个函数默认返回<code class="gatsby-code-text">true</code>，可使React执行更新：</p>\n<div class="gatsby-highlight">\n      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span>nextProps<span class="token punctuation">,</span> nextState<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<p>如果你知道在某些情况下你的组件不需要更新，你可以在<code class="gatsby-code-text">shouldComponentUpdate</code>内返回<code class="gatsby-code-text">false</code>来跳过整个渲染进程，该进程包括了对该组件和之后的内容调用<code class="gatsby-code-text">render()</code>指令。</p>\n<p>In most cases, instead of writing <code class="gatsby-code-text">shouldComponentUpdate()</code> by hand, you can inherit from <a href="https://reactjs.org/docs/react-api.html#reactpurecomponent"><code class="gatsby-code-text">React.PureComponent</code></a>. It is equivalent to implementing <code class="gatsby-code-text">shouldComponentUpdate()</code> with a shallow comparison of current and previous props and state.</p>\n<h2 id="shouldcomponentupdate实战"><a href="#shouldcomponentupdate%E5%AE%9E%E6%88%98" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>shouldComponentUpdate实战</h2>\n<p>这是一个组件的子树。对其中每个组件来说，<code class="gatsby-code-text">SCU</code>表明了<code class="gatsby-code-text">shouldComponentUpdate</code>的返回内容，<code class="gatsby-code-text">vDOMEq</code>表明了待渲染的React元素与原始元素是否相等，最后，圆圈的颜色表明这个组件是否需要重新渲染。</p>\n<figure>\n  <a class="gatsby-resp-image-link" href="/static/should-component-update-5ee1bdf4779af06072a17b7a0654f6db-9a3ff.png" style="display: block" target="_blank" rel="noopener">\n  \n  <span class="gatsby-resp-image-wrapper" style="position: relative; display: block; ; max-width: 555px; margin-left: auto; margin-right: auto;">\n    <span class="gatsby-resp-image-background-image" style="padding-bottom: 66.84684684684686%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACcklEQVQ4y2Ow8jZgAIHgXDcGHn5OMPv///9g+lhdTerB9CTv3QwMsu+U1dhAYqUMTAzpToYM9j0MDF5JAmB1Ti0MmODU/y2MUIOYgZhDgIuLDS5pbA0SYwNaxwS2cPNOxv8MnQw3oNIgXYeRDYO5CATYZUTZgRQjiP1tQi/T/yWzGEGyQEFmPk4ODiCTBUUvussmzO0Fa55/eMrMtRMKY6A2MNQAqZmT+sHcipBwhv97N4DVHaqq1Dzb3bZ6drCUzREGBlGQ2JQ6X4akeAaGbo/HDAwTj+aCFS44PCFg+7ZJWiB29/8rjDCbJ1TOQnHF5NBAiR2VZcnr5VUUdzAwCKO4rpIBN+jf1YYuxMoQzseOIqIixQIWB4L1uZBgYlhwYNLyVcfnOoJds7mCc+GByavXnV6kDeIfXj4FHF5Xurvbt9dktPcyMEisXdqgv/TAlI3XncxUQHIzdvWazd3bu1G1gUkXGE6CDEtPTvLacn65AkiS9xwDw/KTU33Wn1gkBuKfXTENHKs3u9ut7ze1mPwGxv7y7jix1Wdn+h6LCeMFyS07P0F4xanpfgzVHMJAA0WxxjQyuNbewMhACth4f/nClnm1xkAmPw8ft5iwuKA4KxurBJDPB1NTFyXH2RzJriTHwCDIyMwkJSIuKMHMyCgOlJLi5ObgATsmmIkRnDROHpi/cNOqKeDYlZWR4AIlYFDChiZwiIHaDKxRngz6zMUMIENYmFjB8pxQdWywiAGDD5Onrt1aV28CcpEANzdIgwgQiyH7IseKgbnalMGs3IDBEBTULEzg5CIKxeLIvmFgeN7IiCv8/iPRQMz8H5r18AEAM723cnu0lYoAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;">\n      <img class="gatsby-resp-image-image" style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;" alt="should component update" title="" src="/static/should-component-update-5ee1bdf4779af06072a17b7a0654f6db-9a3ff.png" srcset="/static/should-component-update-5ee1bdf4779af06072a17b7a0654f6db-41d3f.png 210w,\n/static/should-component-update-5ee1bdf4779af06072a17b7a0654f6db-101f4.png 420w,\n/static/should-component-update-5ee1bdf4779af06072a17b7a0654f6db-9a3ff.png 555w" sizes="(max-width: 555px) 100vw, 555px">\n    </span>\n  </span>\n  \n  </a>\n    </figure>\n<p>由于以C2为根的子树的<code class="gatsby-code-text">shouldComponentUpdate</code>返回了<code class="gatsby-code-text">false</code>，React不会试图渲染C2，甚至不会在C4和C5上调用<code class="gatsby-code-text">shouldComponentUpdate</code>。</p>\n<p>对C1和C3来说，<code class="gatsby-code-text">shouldComponentUpdate</code>返回了<code class="gatsby-code-text">true</code>，因此React会深入到分支中并检查它们。C6的<code class="gatsby-code-text">shouldComponentUpdate</code>返回了<code class="gatsby-code-text">true</code>，由于待渲染的元素与原始元素并不相等，React会更新这个DOM节点。</p>\n<p>最后一个有趣的情况是C8，React需要渲染这个组件，但是由于组件元素返回值与原元素相等，因此它并没有更新这个DOM节点。</p>\n<p>注意React只需更新C6，因为它是不可避免的。对C8来说，它通过比较待渲染元素与原始元素避免了渲染，对C2的子树和C7，它们甚至都没有执行比较，因为我们设置了<code class="gatsby-code-text">shouldComponentUpdate</code>为<code class="gatsby-code-text">false</code>，<code class="gatsby-code-text">render</code>没有被调用。</p>\n<h2 id="案例"><a href="#%E6%A1%88%E4%BE%8B" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>案例</h2>\n<p>如果想让组件只在<code class="gatsby-code-text">props.color</code>或者<code class="gatsby-code-text">state.count</code>的值变化时重新渲染，你可以像下面这样设定<code class="gatsby-code-text">shouldComponentUpdate</code>：</p>\n<div class="gatsby-highlight">\n      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">class</span> <span class="token class-name">CounterButton</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">shouldComponentUpdate</span><span class="token punctuation">(</span>nextProps<span class="token punctuation">,</span> nextState<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>color <span class="token operator">!==</span> nextProps<span class="token punctuation">.</span>color<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">!==</span> nextState<span class="token punctuation">.</span>count<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>\n        <span class="token attr-name">color</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>color<span class="token punctuation">}</span></span>\n        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>state <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>count<span class="token punctuation">:</span> state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span>\n        Count<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">}</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<p>在以上代码中，<code class="gatsby-code-text">shouldComponentUpdate</code>只检查<code class="gatsby-code-text">props.color</code>和<code class="gatsby-code-text">state.count</code>的变化。如果这些值没有变化，组件就不会更新。当你的组件变得更加复杂时，你可以使用类似的模式来做一个“浅比较”，用来比较属性和值以判定是否需要更新组件。这种模式十分常见，因此React提供了一个辅助对象来实现这个逻辑 - 继承自<code class="gatsby-code-text">React.PureComponent</code>。以下代码可以更简单的实现相同的操作：</p>\n<div class="gatsby-highlight">\n      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">class</span> <span class="token class-name">CounterButton</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>PureComponent</span> <span class="token punctuation">{</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>\n        <span class="token attr-name">color</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>color<span class="token punctuation">}</span></span>\n        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>state <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>count<span class="token punctuation">:</span> state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span>\n        Count<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count<span class="token punctuation">}</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<p>大部分时候，你可以使用<code class="gatsby-code-text">React.PureComponent</code>而不必写你自己的<code class="gatsby-code-text">shouldComponentUpdate</code>，它只做一个浅比较。如果属性或状态变化会因为浅比较的原因而不被感知，这会导致渲染结果和数据的不一致，此时你不能使用它。</p>\n<p>对于更复杂的数据结构这可能成为一个问题。例如，假设你想要一个<code class="gatsby-code-text">ListOfWords</code>组件来渲染一个逗号分隔的单词列表，并使用一个带了点击按钮名字叫<code class="gatsby-code-text">WordAdder</code>的父组件来给子列表添加一个单词。以下代码<em>并不正确</em>： </p>\n<div class="gatsby-highlight">\n      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">class</span> <span class="token class-name">ListOfWords</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>PureComponent</span> <span class="token punctuation">{</span>\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>words<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">\',\'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">class</span> <span class="token class-name">WordAdder</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>\n  <span class="token function">constructor</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>\n      words<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">\'marklar\'</span><span class="token punctuation">]</span>\n    <span class="token punctuation">}</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span>handleClick <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token comment">// This section is bad style and causes a bug</span>\n    <span class="token keyword">const</span> words <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>words<span class="token punctuation">;</span>\n    words<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">\'marklar\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>words<span class="token punctuation">:</span> words<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n    <span class="token keyword">return</span> <span class="token punctuation">(</span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>\n        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ListOfWords</span> <span class="token attr-name">words</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>words<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>\n      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>\n    <span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<p>问题是<code class="gatsby-code-text">PureComponent</code>将会在<code class="gatsby-code-text">this.props.words</code>的新旧值之间做一个简单的比较。由于代码中<code class="gatsby-code-text">words</code>数组在<code class="gatsby-code-text">WordAdder</code>的<code class="gatsby-code-text">handleClick</code>方法中被改变了，尽管数组中的实际单词已经改变，<code class="gatsby-code-text">this.props.words</code>的新旧值还是相等的，因此即便<code class="gatsby-code-text">ListOfWords</code>具有应该被渲染的新单词，它还是不会更新。</p>\n<h2 id="不会突变的数据的力量"><a href="#%E4%B8%8D%E4%BC%9A%E7%AA%81%E5%8F%98%E7%9A%84%E6%95%B0%E6%8D%AE%E7%9A%84%E5%8A%9B%E9%87%8F" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>不会突变的数据的力量</h2>\n<p>避免此类问题最简单的方式是避免使用值可能会<strong>突变</strong>的属性或状态。例如，上面例子中的<code class="gatsby-code-text">handleClick</code>应该用<code class="gatsby-code-text">concat</code>重写成：</p>\n<div class="gatsby-highlight">\n      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>prevState <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>\n    words<span class="token punctuation">:</span> prevState<span class="token punctuation">.</span>words<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">\'marklar\'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<p>ES6支持数组的<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_operator">展开语法</a>可以让它变得更容易。如果你使用的是<code class="gatsby-code-text">Create React App</code>，那么此语法默认可用。</p>\n<div class="gatsby-highlight">\n      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>prevState <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>\n    words<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>prevState<span class="token punctuation">.</span>words<span class="token punctuation">,</span> <span class="token string">\'marklar\'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre>\n      </div>\n<p>你也可以用相似的方式重写可以会突变的对象。例如，假设我们有一个叫<code class="gatsby-code-text">colormap</code>的对象，我们想写一个把<code class="gatsby-code-text">colormap.right</code>改变成<code class="gatsby-code-text">&#39;blue&#39;</code>的函数，我们应该写：</p>\n<div class="gatsby-highlight">\n      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">function</span> <span class="token function">updateColorMap</span><span class="token punctuation">(</span>colormap<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  colormap<span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token string">\'blue\'</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<p>想要实现代码而不突变原始对象，我们可以使用<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign">Object.assign</a>方法：</p>\n<div class="gatsby-highlight">\n      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">function</span> <span class="token function">updateColorMap</span><span class="token punctuation">(</span>colormap<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> colormap<span class="token punctuation">,</span> <span class="token punctuation">{</span>right<span class="token punctuation">:</span> <span class="token string">\'blue\'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<p><code class="gatsby-code-text">updateColorMap</code>现在会返回一个新对象，而不会突变之前的旧对象。<code class="gatsby-code-text">Object.assign</code>在ES6中，需要<code class="gatsby-code-text">polyfill</code>支持。</p>\n<p>有一个JavaScript提议来添加<a href="https://github.com/sebmarkbage/ecmascript-rest-spread">对象展开属性</a>以使其更容易地更新对象并且不会突变对象：</p>\n<div class="gatsby-highlight">\n      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">function</span> <span class="token function">updateColorMap</span><span class="token punctuation">(</span>colormap<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>colormap<span class="token punctuation">,</span> right<span class="token punctuation">:</span> <span class="token string">\'blue\'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre>\n      </div>\n<p>如果使用<code class="gatsby-code-text">Create React App</code>，默认情况下 <code class="gatsby-code-text">Object.assign</code>和对象展开语法都可以使用。</p>\n<h2 id="使用不可突变的数据结构"><a href="#%E4%BD%BF%E7%94%A8%E4%B8%8D%E5%8F%AF%E7%AA%81%E5%8F%98%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用不可突变的数据结构</h2>\n<p><a href="https://github.com/facebook/immutable-js">Immutable.js</a>是解决这个问题的另一种方法。它通过结构共享提供不可突变的，持久的集合：</p>\n<ul>\n<li><em>不可突变</em>:一旦创建，集合就不能在另一个时间点改变。</li>\n<li><em>持久性</em>:可以使用原始集合和一个突变来创建新的集合。原始集合在新集合创建后仍然可用。</li>\n<li><em>结构共享</em>:新集合尽可能多的使用原始集合的结构来创建，以便将复制操作降至最少从而提升性能。</li>\n</ul>\n<p>不可突变性使得跟踪改变很方便。每个变化都会导致产生一个新的对象，因此我们只需检查对象的引用是否有改变。例如，在这个常规的JavaScript代码中：</p>\n<div class="gatsby-highlight">\n      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token punctuation">{</span> foo<span class="token punctuation">:</span> <span class="token string">\'bar\'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> y <span class="token operator">=</span> x<span class="token punctuation">;</span>\ny<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">\'baz\'</span><span class="token punctuation">;</span>\nx <span class="token operator">===</span> y<span class="token punctuation">;</span> <span class="token comment">// true</span>\n</code></pre>\n      </div>\n<p>虽然<code class="gatsby-code-text">y</code>被编辑了，但是由于它与<code class="gatsby-code-text">x</code>索引了相同的对象，这个比较会返回<code class="gatsby-code-text">true</code>。你可以使用<code class="gatsby-code-text">immutable.js</code>实现类似效果：</p>\n<div class="gatsby-highlight">\n      <pre class="gatsby-code-jsx"><code class="gatsby-code-jsx"><span class="token keyword">const</span> SomeRecord <span class="token operator">=</span> Immutable<span class="token punctuation">.</span><span class="token function">Record</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo<span class="token punctuation">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SomeRecord</span><span class="token punctuation">(</span><span class="token punctuation">{</span> foo<span class="token punctuation">:</span> <span class="token string">\'bar\'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> y <span class="token operator">=</span> x<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token string">\'foo\'</span><span class="token punctuation">,</span> <span class="token string">\'baz\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nx <span class="token operator">===</span> y<span class="token punctuation">;</span> <span class="token comment">// false</span>\n</code></pre>\n      </div>\n<p>在这个例子中，<code class="gatsby-code-text">x</code>突变后返回了一个新的引用，因此我们可以安全的确认<code class="gatsby-code-text">x</code>被改变了。</p>\n<p>还有两个库可以帮助我们使用不可突变数据：<a href="https://github.com/rtfeldman/seamless-immutable">seamless-immutable</a> 和<a href="https://github.com/kolodny/immutability-helper">immutability-helper</a>。</p>\n<p>不可突变的数据结构帮助我们轻松地在对象上追踪变化，我们只需要实现<code class="gatsby-code-text">shouldComponentUpdate</code>。这通常可以提供一个不错的性能提升。</p>',
frontmatter:{title:"性能优化",next:null,prev:null},fields:{path:"docs/optimizing-performance.md",slug:"docs/optimizing-performance.html"}}},pathContext:{slug:"docs/optimizing-performance.html"}}}});
//# sourceMappingURL=path---docs-optimizing-performance-html-4380ad88239c099f5fb9.js.map